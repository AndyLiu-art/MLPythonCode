\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} 导入操作系统库}
\PY{k+kn}{import} \PY{n+nn}{os}
\PY{c+c1}{\PYZsh{} 更改工作目录}
\PY{n}{os}\PY{o}{.}\PY{n}{chdir}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{D:}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{softwares}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{applied statistics}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{pythoncodelearning}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{chap1}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{sourcecode}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 导入基础计算库}
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
\PY{c+c1}{\PYZsh{} 导入绘图库}
\PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
\PY{c+c1}{\PYZsh{} 导入OMP模型}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{OrthogonalMatchingPursuit}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{OrthogonalMatchingPursuitCV}
\PY{c+c1}{\PYZsh{} 导入数据集生成工具}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{datasets} \PY{k+kn}{import} \PY{n}{make\PYZus{}sparse\PYZus{}coded\PYZus{}signal}
\PY{c+c1}{\PYZsh{} 导入绘图库中的字体管理包}
\PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k+kn}{import} \PY{n}{font\PYZus{}manager}
\PY{c+c1}{\PYZsh{} 实现中文字符正常显示}
\PY{n}{font} \PY{o}{=} \PY{n}{font\PYZus{}manager}\PY{o}{.}\PY{n}{FontProperties}\PY{p}{(}\PY{n}{fname}\PY{o}{=}\PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{C:}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{Windows}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{Fonts}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{SimKai.ttf}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 使用seaborn风格绘图}
\PY{n}{plt}\PY{o}{.}\PY{n}{style}\PY{o}{.}\PY{n}{use}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{seaborn\PYZhy{}v0\PYZus{}8}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 设置样本量和维度，（这里有点倒置了）}
\PY{n}{n\PYZus{}components}\PY{p}{,} \PY{n}{n\PYZus{}features} \PY{o}{=} \PY{l+m+mi}{512}\PY{p}{,} \PY{l+m+mi}{100}
\PY{c+c1}{\PYZsh{} 设置非零系数的个数}
\PY{n}{n\PYZus{}nonzero\PYZus{}coefs} \PY{o}{=} \PY{l+m+mi}{17}
\PY{c+c1}{\PYZsh{} 生成稀疏数据集}
\PY{n}{y}\PY{p}{,} \PY{n}{X}\PY{p}{,} \PY{n}{w} \PY{o}{=} \PY{n}{make\PYZus{}sparse\PYZus{}coded\PYZus{}signal}\PY{p}{(}
    \PY{n}{n\PYZus{}samples}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
    \PY{n}{n\PYZus{}components}\PY{o}{=}\PY{n}{n\PYZus{}components}\PY{p}{,}
    \PY{n}{n\PYZus{}features}\PY{o}{=}\PY{n}{n\PYZus{}features}\PY{p}{,}
    \PY{n}{n\PYZus{}nonzero\PYZus{}coefs}\PY{o}{=}\PY{n}{n\PYZus{}nonzero\PYZus{}coefs}\PY{p}{,}
    \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,}
    \PY{n}{data\PYZus{}transposed}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
\PY{p}{)}
\PY{c+c1}{\PYZsh{} 非零值的下标}
\PY{p}{(}\PY{n}{idx}\PY{p}{,}\PY{p}{)} \PY{o}{=} \PY{n}{w}\PY{o}{.}\PY{n}{nonzero}\PY{p}{(}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 添加一些噪声}
\PY{n}{y\PYZus{}noisy} \PY{o}{=} \PY{n}{y} \PY{o}{+} \PY{l+m+mf}{0.05} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{randn}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 建立OMP模型}
\PY{n}{omp} \PY{o}{=} \PY{n}{OrthogonalMatchingPursuit}\PY{p}{(}\PY{n}{n\PYZus{}nonzero\PYZus{}coefs}\PY{o}{=}\PY{n}{n\PYZus{}nonzero\PYZus{}coefs}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 模型拟合，无噪声}
\PY{n}{omp}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 提取系数}
\PY{n}{coef1} \PY{o}{=} \PY{n}{omp}\PY{o}{.}\PY{n}{coef\PYZus{}}
\PY{c+c1}{\PYZsh{} 提起系数的非零下标}
\PY{p}{(}\PY{n}{idx\PYZus{}r1}\PY{p}{,}\PY{p}{)} \PY{o}{=} \PY{n}{coef1}\PY{o}{.}\PY{n}{nonzero}\PY{p}{(}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 模型拟合有噪声}
\PY{n}{omp}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y\PYZus{}noisy}\PY{p}{)}
\PY{n}{coef2} \PY{o}{=} \PY{n}{omp}\PY{o}{.}\PY{n}{coef\PYZus{}}
\PY{p}{(}\PY{n}{idx\PYZus{}r2}\PY{p}{,}\PY{p}{)} \PY{o}{=} \PY{n}{coef2}\PY{o}{.}\PY{n}{nonzero}\PY{p}{(}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 建立CVOMP模型}
\PY{n}{omp\PYZus{}cv} \PY{o}{=} \PY{n}{OrthogonalMatchingPursuitCV}\PY{p}{(}\PY{p}{)}
\PY{n}{omp\PYZus{}cv}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y\PYZus{}noisy}\PY{p}{)}
\PY{n}{coef3} \PY{o}{=} \PY{n}{omp\PYZus{}cv}\PY{o}{.}\PY{n}{coef\PYZus{}}
\PY{p}{(}\PY{n}{idx\PYZus{}r3}\PY{p}{,}\PY{p}{)} \PY{o}{=} \PY{n}{coef3}\PY{o}{.}\PY{n}{nonzero}\PY{p}{(}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 绘制真实系数图}
\PY{n}{fig}\PY{p}{,} \PY{n}{axs} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{n}{nrows}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,} \PY{n}{ncols}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{6}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{)}
\PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{512}\PY{p}{)}
\PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sparse signal}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{stem}\PY{p}{(}\PY{n}{idx}\PY{p}{,} \PY{n}{w}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{p}{)}
\PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{512}\PY{p}{)}
\PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recovered signal from noise\PYZhy{}free measurements}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{stem}\PY{p}{(}\PY{n}{idx\PYZus{}r1}\PY{p}{,} \PY{n}{coef1}\PY{p}{[}\PY{n}{idx\PYZus{}r1}\PY{p}{]}\PY{p}{)}
\PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{512}\PY{p}{)}
\PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recovered signal from noisy measurements}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{stem}\PY{p}{(}\PY{n}{idx\PYZus{}r2}\PY{p}{,} \PY{n}{coef2}\PY{p}{[}\PY{n}{idx\PYZus{}r2}\PY{p}{]}\PY{p}{)}
\PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{512}\PY{p}{)}
\PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Recovered signal from noisy measurements with CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{o}{.}\PY{n}{stem}\PY{p}{(}\PY{n}{idx\PYZus{}r3}\PY{p}{,} \PY{n}{coef3}\PY{p}{[}\PY{n}{idx\PYZus{}r3}\PY{p}{]}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplots\PYZus{}adjust}\PY{p}{(}\PY{l+m+mf}{0.06}\PY{p}{,} \PY{l+m+mf}{0.04}\PY{p}{,} \PY{l+m+mf}{0.94}\PY{p}{,} \PY{l+m+mf}{0.90}\PY{p}{,} \PY{l+m+mf}{0.20}\PY{p}{,} \PY{l+m+mf}{0.38}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sparse signal recovery with Orthogonal Matching Pursuit}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{savefig}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{../codeimage/code22.pdf}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
