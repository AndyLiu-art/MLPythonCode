\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} 导入操作系统库}
\PY{k+kn}{import} \PY{n+nn}{os}
\PY{c+c1}{\PYZsh{} 更改工作目录}
\PY{n}{os}\PY{o}{.}\PY{n}{chdir}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{D:}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{softwares}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{applied statistics}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{pythoncodelearning}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{chap1}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{sourcecode}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 导入基础计算库}
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
\PY{c+c1}{\PYZsh{} 导入绘图库}
\PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
\PY{c+c1}{\PYZsh{} 导入logistic回归模型}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{LogisticRegression}
\PY{c+c1}{\PYZsh{} 导入数据集}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{datasets} \PY{k+kn}{import} \PY{n}{load\PYZus{}digits}
\PY{c+c1}{\PYZsh{} 导入标准化工具}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{preprocessing} \PY{k+kn}{import} \PY{n}{StandardScaler}
\PY{c+c1}{\PYZsh{} 导入绘图库中的字体管理包}
\PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k+kn}{import} \PY{n}{font\PYZus{}manager}
\PY{c+c1}{\PYZsh{} 实现中文字符正常显示}
\PY{n}{font} \PY{o}{=} \PY{n}{font\PYZus{}manager}\PY{o}{.}\PY{n}{FontProperties}\PY{p}{(}\PY{n}{fname}\PY{o}{=}\PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{C:}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{Windows}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{Fonts}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{SimKai.ttf}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 使用seaborn风格绘图}
\PY{n}{plt}\PY{o}{.}\PY{n}{style}\PY{o}{.}\PY{n}{use}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{seaborn\PYZhy{}v0\PYZus{}8}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 生成数据及}
\PY{n}{X}\PY{p}{,} \PY{n}{y} \PY{o}{=} \PY{n}{load\PYZus{}digits}\PY{p}{(}\PY{n}{return\PYZus{}X\PYZus{}y}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 标准化}
\PY{n}{X} \PY{o}{=} \PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{X}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 取大于4的类别作为标签}
\PY{n}{y} \PY{o}{=} \PY{p}{(}\PY{n}{y} \PY{o}{\PYZgt{}} \PY{l+m+mi}{4}\PY{p}{)}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{int}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 弹性网的比例}
\PY{n}{l1\PYZus{}ratio} \PY{o}{=} \PY{l+m+mf}{0.5}
\PY{c+c1}{\PYZsh{} 开始绘图}
\PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}
\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{p}{(}\PY{n}{C}\PY{p}{,} \PY{n}{axes\PYZus{}row}\PY{p}{)} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n+nb}{zip}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mf}{0.01}\PY{p}{)}\PY{p}{,} \PY{n}{axes}\PY{p}{)}\PY{p}{)}\PY{p}{:}
    \PY{c+c1}{\PYZsh{} Increase tolerance for short training time}
    \PY{n}{clf\PYZus{}l1\PYZus{}LR} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}
        \PY{n}{C}\PY{o}{=}\PY{n}{C}\PY{p}{,} 
        \PY{n}{penalty}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{l1}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
        \PY{n}{tol}\PY{o}{=}\PY{l+m+mf}{0.01}\PY{p}{,} 
        \PY{n}{solver}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{saga}\PY{l+s+s2}{\PYZdq{}}
    \PY{p}{)}
    \PY{n}{clf\PYZus{}l2\PYZus{}LR} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}
        \PY{n}{C}\PY{o}{=}\PY{n}{C}\PY{p}{,} 
        \PY{n}{penalty}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{l2}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
        \PY{n}{tol}\PY{o}{=}\PY{l+m+mf}{0.01}\PY{p}{,} \PY{n}{solver}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{saga}\PY{l+s+s2}{\PYZdq{}}
    \PY{p}{)}
    \PY{n}{clf\PYZus{}en\PYZus{}LR} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}
        \PY{n}{C}\PY{o}{=}\PY{n}{C}\PY{p}{,} 
        \PY{n}{penalty}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{elasticnet}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
        \PY{n}{solver}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{saga}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
        \PY{n}{l1\PYZus{}ratio}\PY{o}{=}\PY{n}{l1\PYZus{}ratio}\PY{p}{,} 
        \PY{n}{tol}\PY{o}{=}\PY{l+m+mf}{0.01}
    \PY{p}{)}
    \PY{c+c1}{\PYZsh{} 模型拟合}
    \PY{n}{clf\PYZus{}l1\PYZus{}LR}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{)}
    \PY{n}{clf\PYZus{}l2\PYZus{}LR}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{)}
    \PY{n}{clf\PYZus{}en\PYZus{}LR}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} 提取模型的系数}
    \PY{n}{coef\PYZus{}l1\PYZus{}LR} \PY{o}{=} \PY{n}{clf\PYZus{}l1\PYZus{}LR}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
    \PY{n}{coef\PYZus{}l2\PYZus{}LR} \PY{o}{=} \PY{n}{clf\PYZus{}l2\PYZus{}LR}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
    \PY{n}{coef\PYZus{}en\PYZus{}LR} \PY{o}{=} \PY{n}{clf\PYZus{}en\PYZus{}LR}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} 系数的稀疏程度，以含有零的比例}
    \PY{n}{sparsity\PYZus{}l1\PYZus{}LR} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{coef\PYZus{}l1\PYZus{}LR} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{*} \PY{l+m+mi}{100}
    \PY{n}{sparsity\PYZus{}l2\PYZus{}LR} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{coef\PYZus{}l2\PYZus{}LR} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{*} \PY{l+m+mi}{100}
    \PY{n}{sparsity\PYZus{}en\PYZus{}LR} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{coef\PYZus{}en\PYZus{}LR} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{*} \PY{l+m+mi}{100}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{C=}\PY{l+s+si}{\PYZpc{}.2f}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{C}\PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}:\PYZlt{}40\PYZcb{}}\PY{l+s+s2}{ }\PY{l+s+si}{\PYZob{}:.2f\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sparsity with L1 penalty:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
            \PY{n}{sparsity\PYZus{}l1\PYZus{}LR}
        \PY{p}{)}
    \PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}:\PYZlt{}40\PYZcb{}}\PY{l+s+s2}{ }\PY{l+s+si}{\PYZob{}:.2f\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sparsity with Elastic\PYZhy{}Net penalty:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
            \PY{n}{sparsity\PYZus{}en\PYZus{}LR}
        \PY{p}{)}
    \PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}:\PYZlt{}40\PYZcb{}}\PY{l+s+s2}{ }\PY{l+s+si}{\PYZob{}:.2f\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sparsity with L2 penalty:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
            \PY{n}{sparsity\PYZus{}l2\PYZus{}LR}
        \PY{p}{)}
    \PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}:\PYZlt{}40\PYZcb{}}\PY{l+s+s2}{ }\PY{l+s+si}{\PYZob{}:.2f\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Score with L1 penalty:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
            \PY{n}{clf\PYZus{}l1\PYZus{}LR}\PY{o}{.}\PY{n}{score}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{)} \PY{c+c1}{\PYZsh{} 分类准确率}
        \PY{p}{)}
    \PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}:\PYZlt{}40\PYZcb{}}\PY{l+s+s2}{ }\PY{l+s+si}{\PYZob{}:.2f\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Score with Elastic\PYZhy{}Net penalty:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
            \PY{n}{clf\PYZus{}en\PYZus{}LR}\PY{o}{.}\PY{n}{score}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{)}
        \PY{p}{)}
    \PY{p}{)}
    \PY{n+nb}{print}\PY{p}{(}
        \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}:\PYZlt{}40\PYZcb{}}\PY{l+s+s2}{ }\PY{l+s+si}{\PYZob{}:.2f\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
            \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Score with L2 penalty:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
            \PY{n}{clf\PYZus{}l2\PYZus{}LR}\PY{o}{.}\PY{n}{score}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{)}
        \PY{p}{)}
    \PY{p}{)}

    \PY{k}{if} \PY{n}{i} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{n}{axes\PYZus{}row}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{L1 penalty}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{n}{axes\PYZus{}row}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Elastic\PYZhy{}Net}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{l1\PYZus{}ratio = }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{l1\PYZus{}ratio}\PY{p}{)}
        \PY{n}{axes\PYZus{}row}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{L2 penalty}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

    \PY{k}{for} \PY{n}{ax}\PY{p}{,} \PY{n}{coefs} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{axes\PYZus{}row}\PY{p}{,} \PY{p}{[}\PY{n}{coef\PYZus{}l1\PYZus{}LR}\PY{p}{,} \PY{n}{coef\PYZus{}en\PYZus{}LR}\PY{p}{,} \PY{n}{coef\PYZus{}l2\PYZus{}LR}\PY{p}{]}\PY{p}{)}\PY{p}{:}
        \PY{n}{ax}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}
            \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{coefs}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}\PY{p}{,}
            \PY{n}{interpolation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{nearest}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{n}{cmap}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{binary}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{n}{vmax}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
            \PY{n}{vmin}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,}
        \PY{p}{)}
        \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xticks}\PY{p}{(}\PY{p}{(}\PY{p}{)}\PY{p}{)}
        \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}yticks}\PY{p}{(}\PY{p}{(}\PY{p}{)}\PY{p}{)}

    \PY{n}{axes\PYZus{}row}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{C = }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{C}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{savefig}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{../codeimage/code24.pdf}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}]
C=1.00
Sparsity with L1 penalty:                4.69\%
Sparsity with Elastic-Net penalty:       4.69\%
Sparsity with L2 penalty:                4.69\%
Score with L1 penalty:                   0.90
Score with Elastic-Net penalty:          0.90
Score with L2 penalty:                   0.90
C=0.10
Sparsity with L1 penalty:                25.00\%
Sparsity with Elastic-Net penalty:       14.06\%
Sparsity with L2 penalty:                4.69\%
Score with L1 penalty:                   0.90
Score with Elastic-Net penalty:          0.90
Score with L2 penalty:                   0.90
C=0.01
Sparsity with L1 penalty:                84.38\%
Sparsity with Elastic-Net penalty:       68.75\%
Sparsity with L2 penalty:                4.69\%
Score with L1 penalty:                   0.86
Score with Elastic-Net penalty:          0.88
Score with L2 penalty:                   0.89
\end{Verbatim}
