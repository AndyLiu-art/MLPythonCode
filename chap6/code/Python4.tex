\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} 导入操作系统库}
\PY{k+kn}{import} \PY{n+nn}{os}
\PY{c+c1}{\PYZsh{} 更改工作目录}
\PY{n}{os}\PY{o}{.}\PY{n}{chdir}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{D:}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{softwares}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{applied statistics}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{pythoncodelearning}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{chap6}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{sourcecode}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 导入基础计算库}
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
\PY{c+c1}{\PYZsh{} 导入绘图库}
\PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
\PY{c+c1}{\PYZsh{} 导入K折交叉验证}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k+kn}{import} \PY{n}{KFold}
\PY{c+c1}{\PYZsh{} 导入梯度提升分类器}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{ensemble} \PY{k+kn}{import} \PY{n}{GradientBoostingClassifier}
\PY{c+c1}{\PYZsh{} 导入数据集划分工具}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k+kn}{import} \PY{n}{train\PYZus{}test\PYZus{}split}
\PY{c+c1}{\PYZsh{} 导入log\PYZus{}loss函数}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k+kn}{import} \PY{n}{log\PYZus{}loss}
\PY{c+c1}{\PYZsh{} 导入expit函数}
\PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{special} \PY{k+kn}{import} \PY{n}{expit}
\PY{c+c1}{\PYZsh{} 导入绘图库中的字体管理包}
\PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k+kn}{import} \PY{n}{font\PYZus{}manager}
\PY{c+c1}{\PYZsh{} 实现中文字符正常显示}
\PY{n}{font} \PY{o}{=} \PY{n}{font\PYZus{}manager}\PY{o}{.}\PY{n}{FontProperties}\PY{p}{(}\PY{n}{fname}\PY{o}{=}\PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{C:}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{Windows}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{Fonts}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{SimKai.ttf}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 使用seaborn风格绘图}
\PY{n}{plt}\PY{o}{.}\PY{n}{style}\PY{o}{.}\PY{n}{use}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{seaborn\PYZhy{}v0\PYZus{}8}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 样本量}
\PY{n}{n\PYZus{}samples} \PY{o}{=} \PY{l+m+mi}{1000}
\PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{seed}\PY{p}{(}\PY{l+m+mi}{13}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 生成x}
\PY{n}{x1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{uniform}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{n}{n\PYZus{}samples}\PY{p}{)}
\PY{n}{x2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{uniform}\PY{p}{(}\PY{n}{size}\PY{o}{=}\PY{n}{n\PYZus{}samples}\PY{p}{)}
\PY{n}{x3} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{randint}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{n}{n\PYZus{}samples}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 计算概率}
\PY{n}{p} \PY{o}{=} \PY{n}{expit}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sin}\PY{p}{(}\PY{l+m+mi}{3} \PY{o}{*} \PY{n}{x1}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{4} \PY{o}{*} \PY{n}{x2} \PY{o}{+} \PY{n}{x3}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 生成y}
\PY{n}{y} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{binomial}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{p}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{n}{n\PYZus{}samples}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 合并}
\PY{n}{X} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{c\PYZus{}}\PY{p}{[}\PY{n}{x1}\PY{p}{,} \PY{n}{x2}\PY{p}{,} \PY{n}{x3}\PY{p}{]}
\PY{n}{X} \PY{o}{=} \PY{n}{X}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{float32}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 数据集划分}
\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}test} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}
    \PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{,} \PY{n}{test\PYZus{}size}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{9}
\PY{p}{)}
\PY{c+c1}{\PYZsh{} Fit classifier with out\PYZhy{}of\PYZhy{}bag estimates}
\PY{n}{params} \PY{o}{=} \PY{p}{\PYZob{}}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{n\PYZus{}estimators}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+m+mi}{1200}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{max\PYZus{}depth}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+m+mi}{3}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{subsample}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+m+mf}{0.5}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{learning\PYZus{}rate}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+m+mf}{0.01}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{min\PYZus{}samples\PYZus{}leaf}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+m+mi}{1}\PY{p}{,}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{random\PYZus{}state}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+m+mi}{3}\PY{p}{,}
\PY{p}{\PYZcb{}}
\PY{c+c1}{\PYZsh{} 构造模型}
\PY{n}{clf} \PY{o}{=} \PY{n}{GradientBoostingClassifier}\PY{p}{(}\PY{o}{*}\PY{o}{*}\PY{n}{params}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 模型拟合}
\PY{n}{clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 分类准确率}
\PY{n}{acc} \PY{o}{=} \PY{n}{clf}\PY{o}{.}\PY{n}{score}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}test}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Accuracy: }\PY{l+s+si}{\PYZob{}:.4f\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{acc}\PY{p}{)}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 估计器的数量}
\PY{n}{n\PYZus{}estimators} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{n\PYZus{}estimators}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}
\PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{n}{n\PYZus{}estimators}\PY{p}{)} \PY{o}{+} \PY{l+m+mi}{1}
\PY{k}{def} \PY{n+nf}{heldout\PYZus{}score}\PY{p}{(}\PY{n}{clf}\PY{p}{,} \PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}test}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}compute deviance scores on ``X\PYZus{}test`` and ``y\PYZus{}test``.\PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{score} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{n}{n\PYZus{}estimators}\PY{p}{,}\PY{p}{)}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{float64}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} 阶段性预测概率}
    \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{y\PYZus{}proba} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{clf}\PY{o}{.}\PY{n}{staged\PYZus{}predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{)}\PY{p}{:}
        \PY{n}{score}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{2} \PY{o}{*} \PY{n}{log\PYZus{}loss}\PY{p}{(}\PY{n}{y\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}proba}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
    \PY{k}{return} \PY{n}{score}
\PY{c+c1}{\PYZsh{} CV估计}
\PY{k}{def} \PY{n+nf}{cv\PYZus{}estimate}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
    \PY{c+c1}{\PYZsh{} k折}
    \PY{n}{cv} \PY{o}{=} \PY{n}{KFold}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{n}{n\PYZus{}splits}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} 构建模型}
    \PY{n}{cv\PYZus{}clf} \PY{o}{=} \PY{n}{GradientBoostingClassifier}\PY{p}{(}\PY{o}{*}\PY{o}{*}\PY{n}{params}\PY{p}{)}
    \PY{n}{val\PYZus{}scores} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{n}{n\PYZus{}estimators}\PY{p}{,}\PY{p}{)}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{float64}\PY{p}{)}
    \PY{k}{for} \PY{n}{train}\PY{p}{,} \PY{n}{test} \PY{o+ow}{in} \PY{n}{cv}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} 每一折下进行模型拟合}
        \PY{n}{cv\PYZus{}clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{[}\PY{n}{train}\PY{p}{]}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{[}\PY{n}{train}\PY{p}{]}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} 得分}
        \PY{n}{val\PYZus{}scores} \PY{o}{+}\PY{o}{=} \PY{n}{heldout\PYZus{}score}\PY{p}{(}\PY{n}{cv\PYZus{}clf}\PY{p}{,} \PY{n}{X\PYZus{}train}\PY{p}{[}\PY{n}{test}\PY{p}{]}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{[}\PY{n}{test}\PY{p}{]}\PY{p}{)}
    \PY{n}{val\PYZus{}scores} \PY{o}{/}\PY{o}{=} \PY{n}{n\PYZus{}splits}
    \PY{k}{return} \PY{n}{val\PYZus{}scores}

\PY{c+c1}{\PYZsh{} Estimate best n\PYZus{}estimator using cross\PYZhy{}validation}
\PY{n}{cv\PYZus{}score} \PY{o}{=} \PY{n}{cv\PYZus{}estimate}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{)}
\PY{c+c1}{\PYZsh{} Compute best n\PYZus{}estimator for test data}
\PY{n}{test\PYZus{}score} \PY{o}{=} \PY{n}{heldout\PYZus{}score}\PY{p}{(}\PY{n}{clf}\PY{p}{,} \PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{y\PYZus{}test}\PY{p}{)}
\PY{c+c1}{\PYZsh{} negative cumulative sum of oob improvements}
\PY{n}{cumsum} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{n}{np}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{clf}\PY{o}{.}\PY{n}{oob\PYZus{}improvement\PYZus{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} min loss according to OOB}
\PY{n}{oob\PYZus{}best\PYZus{}iter} \PY{o}{=} \PY{n}{x}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{argmin}\PY{p}{(}\PY{n}{cumsum}\PY{p}{)}\PY{p}{]}
\PY{c+c1}{\PYZsh{} min loss according to test (normalize such that first loss is 0)}
\PY{n}{test\PYZus{}score} \PY{o}{\PYZhy{}}\PY{o}{=} \PY{n}{test\PYZus{}score}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
\PY{n}{test\PYZus{}best\PYZus{}iter} \PY{o}{=} \PY{n}{x}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{argmin}\PY{p}{(}\PY{n}{test\PYZus{}score}\PY{p}{)}\PY{p}{]}
\PY{c+c1}{\PYZsh{} min loss according to cv (normalize such that first loss is 0)}
\PY{n}{cv\PYZus{}score} \PY{o}{\PYZhy{}}\PY{o}{=} \PY{n}{cv\PYZus{}score}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
\PY{n}{cv\PYZus{}best\PYZus{}iter} \PY{o}{=} \PY{n}{x}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{argmin}\PY{p}{(}\PY{n}{cv\PYZus{}score}\PY{p}{)}\PY{p}{]}
\PY{c+c1}{\PYZsh{} 设置曲线的颜色}
\PY{n}{oob\PYZus{}color} \PY{o}{=} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{map}\PY{p}{(}\PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{x} \PY{o}{/} \PY{l+m+mf}{256.0}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{190}\PY{p}{,} \PY{l+m+mi}{174}\PY{p}{,} \PY{l+m+mi}{212}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n}{test\PYZus{}color} \PY{o}{=} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{map}\PY{p}{(}\PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{x} \PY{o}{/} \PY{l+m+mf}{256.0}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{127}\PY{p}{,} \PY{l+m+mi}{201}\PY{p}{,} \PY{l+m+mi}{127}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n}{cv\PYZus{}color} \PY{o}{=} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{map}\PY{p}{(}\PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{x} \PY{o}{/} \PY{l+m+mf}{256.0}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{253}\PY{p}{,} \PY{l+m+mi}{192}\PY{p}{,} \PY{l+m+mi}{134}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 设置线型}
\PY{n}{oob\PYZus{}line} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dashed}\PY{l+s+s2}{\PYZdq{}}
\PY{n}{test\PYZus{}line} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{solid}\PY{l+s+s2}{\PYZdq{}}
\PY{n}{cv\PYZus{}line} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dashdot}\PY{l+s+s2}{\PYZdq{}}
\PY{c+c1}{\PYZsh{} plot curves and vertical lines for best iterations}
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}\PY{p}{,} \PY{n}{tight\PYZus{}layout}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{x}\PY{p}{,} \PY{n}{cumsum}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{OOB loss}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
    \PY{n}{color}\PY{o}{=}\PY{n}{oob\PYZus{}color}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{n}{oob\PYZus{}line}
\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{x}\PY{p}{,} \PY{n}{test\PYZus{}score}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Test loss}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
    \PY{n}{color}\PY{o}{=}\PY{n}{test\PYZus{}color}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{n}{test\PYZus{}line}
\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{x}\PY{p}{,} \PY{n}{cv\PYZus{}score}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{CV loss}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} 
    \PY{n}{color}\PY{o}{=}\PY{n}{cv\PYZus{}color}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{n}{cv\PYZus{}line}
\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{n}{oob\PYZus{}best\PYZus{}iter}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{n}{oob\PYZus{}color}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{n}{oob\PYZus{}line}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{n}{test\PYZus{}best\PYZus{}iter}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{n}{test\PYZus{}color}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{n}{test\PYZus{}line}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{n}{cv\PYZus{}best\PYZus{}iter}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{n}{cv\PYZus{}color}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{n}{cv\PYZus{}line}\PY{p}{)}
\PY{c+c1}{\PYZsh{} add three vertical lines to xticks}
\PY{n}{xticks} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{xticks}\PY{p}{(}\PY{p}{)}
\PY{n}{xticks\PYZus{}pos} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}
    \PY{n}{xticks}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)} \PY{o}{+} \PY{p}{[}\PY{n}{oob\PYZus{}best\PYZus{}iter}\PY{p}{,} \PY{n}{cv\PYZus{}best\PYZus{}iter}\PY{p}{,} \PY{n}{test\PYZus{}best\PYZus{}iter}\PY{p}{]}
\PY{p}{)}
\PY{n}{xticks\PYZus{}label} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n+nb}{list}\PY{p}{(}
    \PY{n+nb}{map}\PY{p}{(}\PY{k}{lambda} \PY{n}{t}\PY{p}{:} \PY{n+nb}{int}\PY{p}{(}\PY{n}{t}\PY{p}{)}\PY{p}{,} \PY{n}{xticks}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
    \PY{p}{)} \PY{o}{+} \PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{OOB}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{CV}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Test}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}
\PY{p}{)}
\PY{n}{ind} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{argsort}\PY{p}{(}\PY{n}{xticks\PYZus{}pos}\PY{p}{)}
\PY{n}{xticks\PYZus{}pos} \PY{o}{=} \PY{n}{xticks\PYZus{}pos}\PY{p}{[}\PY{n}{ind}\PY{p}{]}
\PY{n}{xticks\PYZus{}label} \PY{o}{=} \PY{n}{xticks\PYZus{}label}\PY{p}{[}\PY{n}{ind}\PY{p}{]}
\PY{n}{plt}\PY{o}{.}\PY{n}{xticks}\PY{p}{(}\PY{n}{xticks\PYZus{}pos}\PY{p}{,} \PY{n}{xticks\PYZus{}label}\PY{p}{,} \PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{90}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{upper center}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{normalized loss}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{number of iterations}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{savefig}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{../codeimage/code4.pdf}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}]
Accuracy: 0.6820
\end{Verbatim}